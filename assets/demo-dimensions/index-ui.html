<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>寸法線デモ（UIモジュール統合）</title>
    <style>
      html, body { height: 100%; margin: 0; font-family: system-ui, sans-serif; }
      .toolbar { padding: 8px 12px; border-bottom: 1px solid #e5e5e5; display: flex; gap: 12px; align-items: center; }
      .wrap { height: calc(100% - 42px); display: grid; place-items: center; background: #fafafa; }
      svg { background: white; border: 1px solid #ddd; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
      .edge { stroke: #111; stroke-width: 2; }
      .dim { stroke: #0d6efd; stroke-width: 1.5; fill: none; }
      .label { fill: #0d6efd; font-size: 12px; user-select: none; }
      .handle { fill: #ff6b6b; cursor: grab; }
      .handle:active { cursor: grabbing; }
      input[type='range'] { vertical-align: middle; }
    </style>
  </head>
  <body>
    <div class="toolbar">
      <strong>寸法線デモ（UI統合）</strong>
      <label>オフセット: <input id="offset" type="range" min="0" max="60" value="16" /></label>
      <label>小数桁: <input id="dec" type="number" min="0" max="3" step="1" value="1" style="width:4em;" /></label>
      <fieldset style="border:none; display:inline-flex; gap:8px; align-items:center;">
        <legend style="display:none;">外側モード</legend>
        <span>外側:</span>
        <label><input type="radio" name="outside" value="auto" checked /> 自動</label>
        <label><input type="radio" name="outside" value="left" /> 左法線</label>
        <label><input type="radio" name="outside" value="right" /> 右法線</label>
      </fieldset>
    </div>
    <div class="wrap">
      <svg id="stage" width="800" height="520" viewBox="0 0 800 520"></svg>
    </div>
    <script type="module">
      import { DimensionRenderer } from '../../src/ui/svg/dimension-renderer.js';

      const stage = document.getElementById('stage');
      const renderer = new DimensionRenderer(stage, { showHandles: true });
      const points = [
        { x: 200, y: 160 },
        { x: 500, y: 160 },
        { x: 500, y: 360 },
        { x: 200, y: 360 },
      ];
      renderer.setPoints(points);

      // コントロール連携
      const offset = document.getElementById('offset');
      const dec = document.getElementById('dec');
      const outsideRadios = Array.from(document.querySelectorAll('input[name="outside"]'));

      offset.addEventListener('input', () => renderer.setOptions({ offset: Number(offset.value) }));
      dec.addEventListener('input', () => renderer.setOptions({ decimals: Number(dec.value) }));
      outsideRadios.forEach(r => r.addEventListener('change', () => {
        const val = document.querySelector('input[name="outside"]:checked').value;
        if (val === 'auto') {
          renderer.setOptions({ outsideMode: 'auto' });
        } else if (val === 'left') {
          renderer.setOptions({ outsideMode: 'left' });
        } else {
          renderer.setOptions({ outsideMode: 'right' });
        }
      }));
    </script>
  </body>
  </html>
