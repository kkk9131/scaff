# スナップ機能 仕様（フェーズ2）

本仕様は 2D 平面作図エディタにおけるドラッグ時の吸着挙動を定義します。初期対応は「直角スナップ」と「グリッド吸着」です。

## 目的
- ミリ単位で形状寸法を編集する際の操作安定性と再現性を高める。
- 水平・垂直方向や規則的な間隔へ吸着し、意図しない微小ずれを防止する。

## 提供するスナップ
- 直角スナップ（Ortho）
  - 基準点（アンカー）に対する角度が 0/90/180/270° ± 許容角 以内の場合、該当軸へ吸着。
  - 初期許容角: ±7.5°。
- グリッド吸着（Grid）
  - 座標を所定のグリッド間隔（mm）に丸める。
  - 初期グリッド: 50mm。

## 実装方針（MVP）
- コアは純粋関数（`src/core/snap.ts`）で提供し、副作用を持たない。
- 適用順序は「直角 → グリッド」。
- アンカーは MVP では原点（0,0）とする。（将来的にドラッグ開始点や拘束対象点へ拡張）
- UI からのオン/オフ切替は今後対応。MVP では既定値で常時有効。

## API（コア関数）
- `snapToGrid(p, gridMm)`
- `snapToOrtho(p, anchor, toleranceDeg)`
- `applySnaps(p, options)`

```
// options 既定値（SNAP_DEFAULTS）
{
  enableOrtho: true,
  orthoToleranceDeg: 7.5,
  enableGrid: true,
  gridMm: 50,
  anchor: { x: 0, y: 0 }
}
```

## Canvas 統合
- `CanvasArea` のドラッグ処理で、`screenToModel` 後の座標に対して `applySnaps` を適用。
- 目視確認用に薄いグリッドを描画（グリッド間隔が視認できるスケールのみ）。

## 将来拡張
- アンカーの切替（ドラッグ開始点、最近頂点、拘束線）
- スナップ候補の可視化（ガイド線/マーカー）
- サイドバーやショートカットによる ON/OFF と設定編集
- 斜めスナップ（例: 45° 系列）、オブジェクト吸着（端点・中点・交点）
