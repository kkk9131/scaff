# 作図エディタ要件定義書

## フェーズ1 要件定義書（PoC完成版）

### 1. 概要
- 施工現場向けの足場計画支援ツールPoCとして建物形状エディタを完成させる。
- PCおよびタブレットのブラウザからアクセスし、建物の外形・屋根・寸法・3D表示を直感的に生成できることを完成基準とする。
- この段階では足場計算や見積り機能は対象外とし、正確に建物形状を描画できることを優先する。

### 2. 利用環境
- 対応端末: PCブラウザ、タブレットブラウザ（レスポンシブ対応必須）。
- スマートフォン対応: フェーズ2以降に検討。
- ネットワーク接続: 常時接続が必須。

### 3. 入出力形式
**入力**
- テンプレ形状（矩形 / L字 / T字 / コの字）からの開始をサポート。
- 頂点の追加・削除により自由形状に編集可能。
- サイドパネルで各辺の寸法・軒の出・境界距離を数値入力できる。

**出力**
- SVG: 編集画面の状態をそのままエクスポート（ダウンロード含む）。
- JPEG / PDF: html-to-image などのライブラリを利用したキャプチャ出力を提供（PoC内での実現を目指す）。

### 4. 平面図
- Konva.js を用いた2D編集エディタを実装し、頂点ドラッグで形状を編集できる。
- 各辺ごとに寸法・境界距離を数値入力で調整可能。
- 境界線はオフセット生成し、ユーザーが自由にドラッグして位置を微調整できる。

### 5. 立面図
- 北・南・東・西の4方向を自動生成し、平面図の編集内容と同期させる。
- 寸法表記: 外周寸法（パラペット上端まで）を「|──6000──|」形式で表示し、必要に応じてオフセット配置する。
- 屋根タイプ: フラット / 片流れ / 切妻 / 寄棟に対応。
- 勾配表記: 斜辺中央に「10/〇」形式（0.5寸刻み）で表示し、角度表記は行わない。

### 6. 3D表示
- Three.js で外周ポリゴンを押し出し、階高を反映して立体化する。
- 屋根タイプ（フラット / 片流れ / 切妻 / 寄棟）を3Dモデルにも反映させる。
- 寸法表示は行わず形状確認専用ビューとし、2D編集とリアルタイムに同期する。

### 7. 開口部（PoC時点）
- 出窓・ドアなどの開口情報はデータ構造として保持する。
- 立面図や3Dへの反映は将来対応とし、UI実装はフェーズ1では後回しとする。

### 8. 寸法線仕様
- 外周寸法はオフセット表示とし、両端に縦線「|」を付ける。
- 単位は mm 固定（例: 6000）。
- 屋根勾配は斜辺中央に「10/〇」で表記する。
- 寸法線の表示はON/OFF切り替え可能とする。

### 9. 技術スタック
**フロントエンド**
- フレームワーク: Next.js (React)。
- UI/Canvas: Konva.js（2D編集）、Tailwind CSS（スタイリング）。
- 3D描画: Three.js（建物押し出し・屋根生成）。
- レスポンシブ対応: Tailwindのユーティリティクラスと CSS Grid/Flex を活用。

**出力関連**
- SVG生成: Konva.js / ブラウザのSVG API。
- JPEG出力: html-to-image / dom-to-image。
- PDF出力: pdf-lib / jsPDF。

**その他**
- 状態管理: React Hooks / Context API（フェーズ1は軽量構成）。
- 開発環境: TypeScript、Vercel（ホスティング）、ESLint / Prettier。

### 10. 完成基準
- ブラウザ上で平面・立面・3Dの建物形状が作成・確認できる。
- SVG 出力が動作する（JPEG・PDF出力は PoC内での対応を目指す）。
- 屋根4タイプ（フラット / 片流れ / 切妻 / 寄棟）と勾配表記「10/〇」に対応している。
- 寸法線「|──6000──|」を正しく表示できる。
- PC / タブレットでのレスポンシブ利用に支障がない。

## 長期ビジョンと将来拡張（参考）
- 建物を簡単かつ正確に作図できる直感的エディタで、従来のCADとの差別化を図る。
- 足場業者・公務店を主対象とし、ミリ単位の精度と未来的UI（グレー基調＋ネオグリーンアクセント）を重視する。
- 2階層以上の管理、JSON保存／再編集、見積書出力、足場図面自動生成などをフェーズ2以降で段階的に実現する。
