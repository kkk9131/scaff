# 開発ロードマップ

## MVP版（2D平面作図まで）

### フェーズ1: 基盤セットアップ

- [x] Next.js + TypeScript 環境構築
- [x] Tailwind + shadcn/ui 導入
- [x] Three.js + postprocessing セットアップ（将来の発光用）
- [x] 左サイドバーUI（アイコンのみ表示、展開可能）
- [x] 中央キャンバス配置（平面図表示領域）
- [x] 上部バー（保存／読み込みボタン配置）

### フェーズ2: 2D平面図エディタ

- [x] テンプレート呼び出し（長方形）
- [x] テンプレート呼び出し（L字／コの字／T字）
- [x] 寸法入力（各辺をクリック→ミリ単位入力）
- [x] 頂点ドラッグ編集（寸法自動更新）
 - [x] スナップ機能（直角・グリッド吸着）
- [x] 寸法線＋数値の常時表示（各辺外側）
  - 外側判定: 多角形の向き（CW/CCW）から自動/手動切替
  - 単位: エディタ内ラベルは mm 表示（小数桁切替可）
  - オフセット: px/mm 指定（ズーム連動）
  - ラベル衝突回避: ラベル同士/辺/寸法線との干渉を外側方向へ回避、必要に応じてリーダー線描画
- [x] 線スタイル（壁＝ネオンブルー、補助＝ライトグレー）

- [x] 軒の出（Eaves Overhang）作図機能
  - 外側オフセットのみ（内側なし）、L/U/T の凹部は引っ込み（外側輪郭を Union で抽出）
  - 一括生成後、軒ラインクリックで当該辺の出幅(mm)を編集可能
  - 角は両ライン延長の交点で直角接続（直角マイター、極端角は自動ベベル）
  - サイドバー: 「軒の出」ON/OFF + 出幅(mm)、リアルタイムプレビュー必須、辺ごとの ON/OFF は不要
  - 表示: 壁と同色（ネオンブルー）、点線。ラベルは壁線と軒線の間（簡易衝突回避）
  - 保存: フェーズ5で実施（本フェーズでは対象外）

- [x] ズーム機能（キャンバス拡大縮小）
  - 初期実装: ホイール/キーボード/右上UIに対応、カーソル中心ズーム、px/mm連動、ヒットテスト/ドラッグ/寸法線へ適用（完了）
  - 入力: マウスホイール/トラックパッドのピンチ、Ctrl/Cmd+スクロール、キーボード(+/-)
  - ズーム中心: カーソル位置（フォーカス座標を維持）、範囲: 0.1x〜10x（調整可）
  - 尺度連動: px/mm のスケールに追従し、寸法線/ラベル/グリッド表示を適切にスケーリング
  - UI: 上部バーに + / - / 100% 表示・リセットボタンを配置
  - スムーズズーム（アニメ/補間）とスナップ（グリッド/直角）との整合を担保
  - E2E: Playwright＋MCPでズーム操作の回帰を担保（軽量1〜2本）
    - セットアップ: `@playwright/test` 追加、`playwright.config.ts` 作成、`npm run e2e` スクリプト
    - test-id: ズームUI（`zoom-minus`/`zoom-plus`/`zoom-reset`/`zoom-label`）、キャンバス（`plan-canvas`）
    - テスト項目: クリックで倍率変化、ホイールで拡大/縮小、`+`/`-`/`0` キー操作、リセットで100%復帰
    - MCP実行: MCPクライアントから `playwright test` を呼び出す設定（`mcp.json` など）

- [x] 階層（フロア）管理（Phase 2 完了｜保存はPhase 5）
  - [x] フロアリスト（1F/2F…）: 追加/削除/複製/改名、アクティブ切替（行クリック/▲▼/PgUp・PgDn）
  - [x] 高さ編集: 床レベルZ(mm)/階高(mm) を各行でインライン入力
  - [x] 編集範囲: アクティブ階のみ編集可。他階はロック扱い（ヒットテスト不可）、視認用に薄色表示
  - [x] 表示: 複数階同時表示。下階→上階に重ね、非アクティブは壁=薄色実線+極薄塗り、軒=点線
  - [x] 複製: 色を自動ローテーション、形状はディープコピー（独立編集）、eavesはデフォルトOFF
  - [x] 軒の出: 各階ごとに保持。編集はアクティブ階で辺クリック→mm入力（非アクティブは表示のみ）
  - [x] 3D準備: `elevationMm`/`heightMm` を保持。押し出し規則（zBottom=elevation, zTop=elevation+height）を仕様化
  - [ ] 色の手動上書き、フロア順の並び替え（UI）
  - [ ] レイヤー可視/ロックの保存（将来、必要に応じ昇格）

- [ ] 階層管理（レイヤー）
  - レイヤー種別: 壁, 寸法, 軒の出, グリッド, ガイド（必要に応じ拡張）
  - 操作: 表示ON/OFF（目玉）、ロック、描画順の管理（最低限は固定順でも可）
  - UI: サイドバーに「レイヤー」セクションを追加
  - 保存: フェーズ5で実施（本フェーズでは対象外。現段は一時状態）

### フェーズ5: データ管理（MVP必須）

- [x] JSON保存（外形座標・寸法情報を保持）
- [x] JSON読み込み（保存データを再編集可能に）
- [x] 軒の出設定（enabled/amountMm/perEdge）を保存・読み込み対象に含める
- [x] フロア情報（id/name/elevationMm/heightMm/color/walls/eaves）を保存・読み込み
- [x] ローカルストレージ自動保存/復元（session継続性の担保）
- [x] エディタ初期化（TopBarの…メニューから完全初期化）
- [x] **ここでMVP完成（2D平面で正確な作図＋保存／読み込みが可能）**

## 全体版（立面＋3D込み）

### フェーズ3: 立面図自動生成

- [ ] 平面＋高さデータから立面図を自動生成（東西南北）
- [ ] 寸法線表示（壁高・屋根頂点高）
- [ ] 寸法線オン／オフ切替（サイドバーから）
- [ ] 屋根生成ロジック（フラット／切妻／寄棟＋勾配角度入力）

### フェーズ4: 3Dワイヤーフレーム表示

- [ ] Extrude処理で外壁立ち上げ
- [ ] 屋根ワイヤーフレーム生成（切妻／寄棟／フラット）
- [ ] Three.js LineSegmentsで線描画
- [ ] マウス操作（回転／ズーム／パン）
- [ ] 線色と発光（壁＝ブルー、屋根＝オレンジ、補助＝グレー）

### フェーズ6: UI演出 & polish

- [ ] サイドバー展開アニメーション（Framer Motion）
- [ ] ビュー切替アニメーション（平面⇄立面⇄3D）
- [ ] 寸法線フェードイン／アウト演出
- [ ] サイドバーアイコンのネオグリーングロー（アクティブ時）

## 開発優先度まとめ

- [ ] **MVP必須:** フェーズ1 + フェーズ2 + フェーズ5
- [ ] **将来追加:** フェーズ3（立面）、フェーズ4（3D）
- [ ] **見た目強化:** フェーズ6（未来感エフェクト）
