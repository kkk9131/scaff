# フェーズ1 PoC タスク計画

## 目的
- フェーズ1要件（docs/作図エディタ要件定義書.md）を満たすための実装タスクを整理し、優先度と依存関係を明確にする。
- 各タスクは実装担当がそのまま Issue 化できる具体性をもたせ、完了条件のチェックリストを付与する。

## タスク一覧

### 0. 基盤整備
- [ ] `src/` 配下のディレクトリ構造（`core/`, `ui/`, `io/`）を初期化し、TypeScript パスエイリアスを設定する。
- [ ] 共通レイアウト（SideBar + Canvas + Inspector）を持つ Next.js ページを作成する。
- [ ] Tailwind CSS のテーマとレスポンシブブレークポイントを定義し、Storybook もしくは簡易コンポーネントプレビュー環境を準備する。
- [ ] React Context を用いた状態管理スケルトン（プロジェクト/階層/屋根設定）を作成する。

### 1. 平面図エディタ（Konva.js）
- [ ] テンプレ形状（矩形 / L字 / T字 / コの字）を生成するユーティリティとUIセレクタを実装する。
- [ ] 頂点ドラッグ・追加・削除を行うコンポーネントを実装し、変形時のスナップと履歴（Undo/Redo）の骨組みを作る。
- [ ] サイドパネルで辺長・境界距離・軒の出をミリ単位で編集し、キャンバス反映と双方向同期を行う。
- [ ] SVGエクスポート機能（現在の平面図状態をダウンロード可能にする）を追加する。

### 2. 立面図生成
- [ ] 平面図データと階高情報から北/南/東/西立面を計算する `core/elevation` モジュールを整備する。
- [ ] 屋根タイプ（フラット / 片流れ / 切妻 / 寄棟）に応じた外周ラインと「|──6000──|」寸法線の描画ロジックを実装する。
- [ ] 勾配表記「10/〇」を0.5寸刻みで算出し、適切な位置に描画する。
- [ ] 寸法線のON/OFFトグル、表示設定を保持するUIを作成する。

### 3. 3D表示（Three.js）
- [ ] 平面ポリゴンを押し出して外壁モデルを生成する処理を実装する。
- [ ] 屋根4タイプを3Dモデルに反映するメッシュ生成ロジックを実装する。
- [ ] 2D編集と3D表示のリアルタイム同期（状態管理連携とレンダリング最適化）を行う。
- [ ] マウス/タッチの回転・ズーム・パン操作をサポートするコントローラを導入する。

### 4. 出力（SVG / JPEG / PDF）
- [ ] Konva ステージのSVG書き出しとブラウザダウンロードを安定化する。
- [ ] html-to-image / dom-to-image を利用したJPEGキャプチャを実装し、主要ブラウザでの互換性を検証する。
- [ ] pdf-lib もしくは jsPDF を用いて画面状態をPDF化するフローを試験的に構築する。
- [ ] 出力ダイアログでフォーマット選択・ファイル名指定・各フォーマットのガイドを提供する。

### 5. データモデル・開口部
- [ ] 出窓・ドア情報を保持するスキーマ（寸法・位置・向き）を定義し、JSON保存時に含める。
- [ ] 開口部データのダミー入力UIまたはテストデータを用意し、立面・3D連携に備える。

### 6. テスト・品質担保
- [ ] ジオメトリ計算（平面→立面/3D）を検証するユニットテストを `tests/core/` に追加する。
- [ ] UI主要機能（テンプレ選択、頂点編集、寸法入力）を確認する E2E もしくは Playwright テストの雛形を用意する。
- [ ] SVG/JPEG/PDF 出力に対するスナップショットまたは自動検証手順をドキュメント化する。
- [ ] CI で lint / test を実行する GitHub Actions（もしくは代替CI）の設定を追加する。

### 7. ドキュメント整備
- [ ] README.md / README.ja.md に開発手順、利用ライブラリ、ビルド・テストコマンドを追記する。
- [ ] `docs/２D平面作図MVP 要件定義書.md` と今回のタスク計画の整合性を確認し、差異があれば更新する。
- [ ] Activity Log の運用ルールに従い、主要な実装フェーズ完了時に要約を追記する。

## 依存関係と優先度
1. 0番（基盤整備）を完了させることで、各機能モジュールの開発が並行可能になる。
2. 平面図（1）完了後に立面（2）と3D（3）が進められる。立面・3Dは平面図データモデルに依存するため、最低限のAPIを先に確定させる。
3. 出力（4）は平面・立面・3D 表示の安定後に統合テストする。
4. 開口部（5）はPoC段階ではデータ構造のみで可。将来のUI実装を見据え、テストデータで連携チェックを行う。
5. テスト・ドキュメント（6, 7）は各フェーズで平行実施し、最終的にCIとガイドラインの整合を取る。

## 完了条件
- 上記チェックボックスが全て完了し、要件定義書（フェーズ1）にある機能・品質条件が満たされた状態。
- 実装された機能が PC / タブレット双方で操作確認され、主要ブラウザ（Chromium / Firefox / Safari）で致命的な不具合がないこと。
