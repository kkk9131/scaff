# 階層管理（フロア）要件定義（Phase 2）

本ドキュメントは「1階/2階…」といった階層（フロア）管理の要件を定義する。将来の立面・3D拡張を見据え、高さ座標（Z）を保持する。

## 用語定義
- 床レベルZ: 各階の床上端の絶対高さ(mm)。Z=0 を基準（既定: 1F床=0mm）。+Zは上向き。
- 階高: その階の床上端から天井（または壁頂）までの高さ(mm)。

## 目的/スコープ
- 平面座標はそのまま複製し、1F/2F…の階層で独立編集できるようにする。
- 将来の立面/3Dでは floors[].elevationMm と floors[].heightMm をそのまま使用する。

## 複製ルール
- 複製対象: 壁のみ（寸法・軒の出・ガイド等は複製しない）。
- 独立性: 完全コピー（階間リンクなし）。以後は各階で独立編集。

## 表示/編集要件
- アクティブ階のみ編集可。他階はヒットテスト不可（ロック扱い）、半透明表示。
- 複数階を同時表示可能。描画順は下階→上階（下から重ねる）。
- 階ごとに壁・軒の出の線色を変更可能（パレットの自動割当＋手動上書きを想定）。

## UI（階層セクション）
- 階リスト（1F/2F…）で以下を操作:
  - 追加 / 削除 / 複製 / リネーム
  - 高さ入力: 各行で 床レベルZ(mm)・階高(mm) を直接編集
  - 表示ON/OFF（目）・ロック（鍵）
- ショートカット: 階切替（PgUp/PgDn など）。
- Fit/ズームは階に依存せず全体に適用。

## ズーム/スナップ整合
- px/mm は全体スケールに追従。階の可視/編集状態に依らずズームは共通。
- スナップはアクティブ階の編集時のみ適用。

## データモデル（保存スキーマ案）
```
{
  floors: [
    {
      id: string,
      name: string,           // 例: "1F", "2F"
      elevationMm: number,    // 床レベルZ
      heightMm: number,       // 階高
      color?: {
        walls?: string,
        eaves?: string,
      },
      walls: { /* 平面形状（Polygon等）*/ },
      eaves?: { enabled: boolean, amountMm: number, perEdge?: { [edgeIndex: number]: number } },
    }
  ]
}
```
- レイヤーの可視/ロック状態は「保存なし」（セッション/UI状態）。必要に応じ将来保存に昇格。

## 既定値/上限（提案）
- 新規階の既定値:
  - name: 自動採番（nF）
  - elevationMm: 直下階の elevationMm + heightMm
  - heightMm: 直下階と同じ（初期 2800mm など）
  - color: パレットからローテーション
- 最大階数: 明示制限なし（運用目安: 20 程度）

## 受け入れ基準
- 階の追加/削除/複製/リネーム・高さ編集が即時反映される。
- アクティブ階のみ編集可、他階は半透明/ロックでヒットしない。
- 階ごと線色が反映され、複数階同時表示で視認性が保たれる。
- 保存/読込で floors スキーマが再現される（レイヤー可視/ロックはセッションのみ）。

