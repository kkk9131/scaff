# 軒の出（Eaves Overhang）設計メモ

本ドキュメントは 2D 平面図エディタにおける「軒の出」作図機能の要件と最小実装方針をまとめる。

## 要件（確定事項）
- 範囲・定義: 外側のみ（内側オフセットは行わない）
- 凹部（L/U/T 形状）: 凹形状に沿って“引っ込む”（ポリゴン外側オフセット後、自己交差解消＝Union）
- 入力パラメータ: 一括生成後、対象の軒の出ラインをクリックして辺ごとに出幅(mm)を編集可能
- 角の結合: 両ラインの延長線上の交点で直角に接続（直角マイター相当）
- UI/UX:
  - サイドバーに「軒の出」セクションを追加（ON/OFF, 出幅 mm）
  - 辺ごとの ON/OFF は不要（全辺に適用。出幅は個別編集可）
  - リアルタイムプレビュー必須（入力変更・クリック編集で即時反映）
- 表示（2D スタイル）:
  - 線色は壁と同じ（ネオンブルー）
  - 線種は点線（dash）
  - 寸法ラベルは「壁ラインと軒の出ラインの間」に配置
  - 衝突は簡易回避で可
- 幾何ルール: ポリゴン外側オフセット実行 → 自己交差は Union で一体化

## 最小実装の分割タスク
1. コア幾何
   - 単純多角形の外側オフセット（一定距離）
   - 角の直角マイター処理（極端角はベベルに自動フォールバック）
   - 自己交差の検出と Union（簡易スイープ or ライブラリ不使用の範囲で近似）
   - 凹部での“引っ込み”形状の一体化（外側輪郭の抽出）

2. UI/編集
   - サイドバー: 「軒の出」ON/OFF トグル、出幅(mm)入力
   - キャンバス: 軒ラインクリックでその辺の出幅を編集（モーダル/プロンプトで mm 入力）
   - 入力変更の即時プレビュー

3. 表示
   - 壁色（ネオンブルー）で点線表示（dasharray）
   - 寸法ラベルを壁と軒ラインの間に配置（簡易衝突回避）

4. データモデル/保存
   - `eave: { enabled: boolean, amountMm: number, perEdge?: { [edgeId]: number } }` を内部状態に追加
   - JSON 保存/読込に上記を拡張（未設定は無効として解釈）

5. テスト
   - Rect/L/U/T テンプレートでの外側オフセット結果
   - 凹部での“引っ込み”と Union 後の一体形状
   - 角の直角マイターと極端角のフォールバック

## 受け入れ基準（Done 条件）
- ON/OFF と一括出幅(mm)で外側に正しく軒ラインが描画される
- L/U/T でも自己交差が解消された一体の軒輪郭が得られる
- 角は直角接続で視覚破綻がない（極端角は自動ベベル）
- 辺クリックで出幅個別編集が可能で即時反映される
- ラベルが壁と軒ラインの間に表示され、既存寸法線と大きく干渉しない
- JSON 保存/読込で状態が再現される

## 実装メモ
- 既存レンダリング: Canvas 本体 + SVG オーバーレイ（寸法線）に準拠
- 線スタイル: `COLORS.wall` を流用し、SVG/Canvas では `setLineDash` / `stroke-dasharray` を使用
- オフセット幾何: 辺ごとに法線方向へ平行移動→交点計算→頂点列再構成。自己交差は線分交差で切断→外側輪郭を抽出

