# ズーム機能 設計メモ（Phase 2）

本ドキュメントはキャンバスの拡大縮小（ズーム）の要件・UX・内部設計を示す。

## スコープ
- 対象ビュー: 平面図（plan）
- 入力: マウスホイール/トラックパッド、ピンチ（OS依存のスクロール）、キーボード(+/-)、UIボタン(±/100%)
- 範囲: 0.1x〜10x（調整可）

## 要件（UX/挙動）
- カーソル中心ズーム: ズーム操作時、カーソル位置のモデル座標が画面上で不動に見えるよう維持
- スムーズズーム: 連続入力に対して指数スケールで補間（例: 1.05^delta）
- スナップ整合: ズームによる `pxPerMm` 変化に、寸法線のオフセット(px/mm)・グリッド間隔表示を追従
- ズームUI: 上部バーに「+」「-」「100%」「リセット（Fit）」ボタン表示
- 保存対象外（Phase 5で検討）

## 内部設計
- 状態
  - `scale`（number, 既定 1.0, 範囲 [0.1, 10]）
  - `pan`（Vec2, CSS px, キャンバス中心の画面オフセット）
- 変換
  - 既存の `pxPerMmBase`（自動フィットの基準）に対し、`pxPerMm = pxPerMmBase * scale`
  - カーソル中心維持:
    - 入力: 画面座標 `cPx` → モデル座標 `m` を `scale` 変更前後で比較し、`pan` を調整
    - 具体: `m = screenToModel(cPx, view, pxPerMm_before)` を保ったまま `pxPerMm_after` で同じ `cPx` へ写すよう `pan` を再設定
- ホイール入力
  - `deltaY` を指数的に変換: `scaleNext = clamp(scale * pow(1.05, -deltaY))`
  - Ctrl/Cmd 押下時はより強い係数（ピンチ想定）

## API/イベント（案）
- `onZoom(delta, anchorPx)` ズーム変更（アンカー=カーソル位置）
- `onZoomReset()` 100%に戻す
- `onZoomFit()` 図形が常時9割程度で収まるようフィット
- `onPan(dx, dy)` パン（中ボタンやSpace+ドラッグなどは将来対応）

## 受け入れ基準
- ズームイン/アウトでカーソル下の位置が画面内で動かない
- スケールが 0.1x〜10x にクランプされる
- 寸法線オフセット、グリッド表示がスケールに追従して破綻しない
- 100%/Fit/± ボタンが機能し、状態がUIに反映される

## 実装計画（最小）
1. Pageに `scale` と UIボタンを追加（TopBarに表示）
2. CanvasAreaに `scale` を渡し、`pxPerMm` を再計算
3. wheelイベントで `onZoom()` を呼ぶ（カーソル座標取得・pan調整）
4. ラベル等のフォントはCSS px固定（12px）とし、読みやすさ維持（将来拡大に合わせる検討）

